@prefix map: <#>.
@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> . 
@prefix skos: <http://www.w3.org/2004/02/skos/core#> . 
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> . 
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix eli: <http://data.europa.eu/eli/ontology#> .
@prefix codex: <https://data.vlaanderen.be/ns/wetgeving#> .

map:RechtsgrondDocument
	rr:logicalTable [ rr:sqlQuery """
		SELECT	(CASE Numac WHEN 0 THEN BSPagina ELSE Numac END) AS ID,
				YEAR(CONVERT(date, Datum)) AS datumDocumentJaar,
				MONTH(CONVERT(date, Datum)) AS datumDocumentMaand,
				DAY(CONVERT(date, Datum)) AS datumDocumentDag,
				(CASE  
					WHEN WetgevingDocumentTypeId in (1000002, 1000003, 1000004, 1000009, 1000010, 1000012, 1000018, 1000021, 1000029, 1000030, 1000032, 1000035, 1000038, 1000040, 1000041, 1000043, 1000047, 1000048) THEN 'BESLUIT'
					WHEN WetgevingDocumentTypeId in (1000005, 1000011, 1000016, 1000020) THEN 'WET'
					WHEN WetgevingDocumentTypeId in (1000001, 1000008, 1000013, 1000026) THEN 'DECREET'
					WHEN WetgevingDocumentTypeId in (1000017, 1000031) THEN 'GRONDWET'
					WHEN WetgevingDocumentTypeId in (1000042) THEN 'ORDONNANTIE'
					ELSE 'AFTESTEMMEN'
				END) AS typeDocumentURI,
			CONVERT(date, Datum) AS datumDocumentdatum
		FROM WetgevingDocument
	""" 
	];
	rr:subjectMap [
		rr:template 'http://www.ejustice.just.fgov.be/eli/{"typeDocumentURI"}/{"datumDocumentJaar"}/{"datumDocumentMaand"}/{"datumDocumentDag"}/{"ID"}'; #Fallback (Blank note) voorzien indien artikel van voor 97 is (toen nog geen Numac toegevoegd) -> pagina staatsblad, maakt met datum unieke verwijzing)
		rr:class eli:LegalResource; 
	];
	rr:predicateObjectMap [ 
		rr:predicate eli:date_document; 
		rr:objectMap [rr:column '"datumDocumentdatum"'];
	].

map:RechtsgrondDocumentType
	rr:logicalTable [ rr:sqlQuery """
		SELECT 	(CASE Document.Numac WHEN 0 THEN Document.BSPagina ELSE Document.Numac END) AS ID,
				YEAR(CONVERT(date, Document.Datum)) AS datumDocumentJaar,
				MONTH(CONVERT(date, Document.Datum)) AS datumDocumentMaand,
				DAY(CONVERT(date, Document.Datum)) AS datumDocumentDag,
				(CASE  
					WHEN Document.WetgevingDocumentTypeId in (1000002, 1000003, 1000004, 1000009, 1000010, 1000012, 1000018, 1000021, 1000029, 1000030, 1000032, 1000035, 1000038, 1000040, 1000041, 1000043, 1000047, 1000048) THEN 'BESLUIT'
					WHEN Document.WetgevingDocumentTypeId in (1000005, 1000011, 1000016, 1000020) THEN 'WET'
					WHEN Document.WetgevingDocumentTypeId in (1000001, 1000008, 1000013, 1000026) THEN 'DECREET'
					WHEN Document.WetgevingDocumentTypeId in (1000017, 1000031) THEN 'GRONDWET'
					WHEN Document.WetgevingDocumentTypeId in (1000042) THEN 'ORDONNANTIE'
					ELSE 'AFTESTEMMEN'
				END) AS typeDocumentURI,
				(CASE  
					WHEN 
					DocumentType.Omschrijving in (
						'Besluit van de secretaris-generaal' , 
						'Besluit van de administrateur-generaal' ,
						'Besluit van de voorzitter van het Eigen Vermogen' ,
						'Besluit van het afdelingshoofd',
						'Besluit van de algemeen directeur' ,
						'Besluit van de hoofddirecteur-hoofdconservator' ,
						'Besluit van de inspecteur-generaal' ,
						'Besluit van het diensthoofd',
						'Besluit van de directeur')
					THEN 'Besluit_van_een_ambtenaar'
					WHEN DocumentType.Omschrijving in (
						'’s Konings Verklaring' ,
						'Edict' ,
						'Keizerlijk Decreet' ,
						'Besluitwet',
						'Bijzondere Ordonnantie' ,
						'Besluit van de Regent' ,
						'Overeenkomst' ,
						'Besluit van de Raad van Bestuur' ,
						'Besluit van de gedelegeerd bestuurder' ,
						'Gezamenlijke bekendmaking van de gemeenschappelijke nautische autoriteit' ,
						'Gemeenschappelijke verklaring' ,
						'Huishoudelijk Reglement' ,
						'Besluit van het Politiek College van de Vlaamse-Nederlandse Scheldecommissie')
					THEN 'Andere'
					WHEN DocumentType.Omschrijving = 'Besluit van de Vlaamse Regering' THEN 'Besluit_van_de_Vlaamse_Regering'
					WHEN DocumentType.Omschrijving = 'Bijzonder Decreet' THEN 'Besluit_van_de_Vlaamse_Regering'
					WHEN DocumentType.Omschrijving = 'Bijzondere Wet' THEN 'Bijzondere_Wet'
					WHEN DocumentType.Omschrijving = 'Gecodificeerde decreten' THEN 'Gecodificeerde_decreten'
					WHEN DocumentType.Omschrijving = 'Gecoördineerde wetten' THEN 'Gecoördineerde_wetten'
					WHEN DocumentType.Omschrijving = 'Genummerd koninklijk besluit' THEN 'Genummerd_koninklijk_besluit'
					WHEN DocumentType.Omschrijving = 'Koninklijk Besluit' THEN 'Koninklijk_Besluit'
					WHEN DocumentType.Omschrijving = 'Ministerieel besluit' THEN 'Ministerieel_besluit'
					ELSE DocumentType.Omschrijving
				END) AS typeDocument
		FROM WetgevingDocument AS Document, WetgevingDocumentType AS DocumentType
		WHERE Document.WetgevingDocumentTypeId = DocumentType.id
	""" 
	];
	rr:subjectMap [
		rr:template 'http://www.ejustice.just.fgov.be/eli/{"typeDocumentURI"}/{"datumDocumentJaar"}/{"datumDocumentMaand"}/{"datumDocumentDag"}/{"ID"}'; #Fallback (Blank note) voorzien indien artikel van voor 97 is (toen nog geen Numac toegevoegd) -> pagina staatsblad, maakt met datum unieke verwijzing)
		rr:class eli:LegalResource; 
	];
	rr:predicateObjectMap [ 
		rr:predicate eli:type_document; 
		rr:objectMap [	rr:template 'https://data.vlaanderen.be/id/conceptscheme/AardWetgeving/{"typeDocument"}';
						rr:termType rr:IRI ];
	].

map:RechtsgrondDocumentThema
	rr:logicalTable [ rr:sqlQuery """
		SELECT 	(CASE Document.Numac WHEN 0 THEN Document.BSPagina ELSE Document.Numac END) AS ID,
				YEAR(CONVERT(date, Document.Datum)) AS datumDocumentJaar,
				MONTH(CONVERT(date, Document.Datum)) AS datumDocumentMaand,
				DAY(CONVERT(date, Document.Datum)) AS datumDocumentDag,
				(CASE  
					WHEN Document.WetgevingDocumentTypeId in (1000002, 1000003, 1000004, 1000009, 1000010, 1000012, 1000018, 1000021, 1000029, 1000030, 1000032, 1000035, 1000038, 1000040, 1000041, 1000043, 1000047, 1000048) THEN 'BESLUIT'
					WHEN Document.WetgevingDocumentTypeId in (1000005, 1000011, 1000016, 1000020) THEN 'WET'
					WHEN Document.WetgevingDocumentTypeId in (1000001, 1000008, 1000013, 1000026) THEN 'DECREET'
					WHEN Document.WetgevingDocumentTypeId in (1000017, 1000031) THEN 'GRONDWET'
					WHEN Document.WetgevingDocumentTypeId in (1000042) THEN 'ORDONNANTIE'
					ELSE 'AFTESTEMMEN'
				END) AS typeDocumentURI,
				Thema.omschrijving AS thema
		FROM WetgevingDocument AS Document, WetgevingDocument_Thema AS DocumentThema, Thema
		WHERE Document.Id = DocumentThema.WetgevingDocumentId AND DocumentThema.ThemaId = Thema.Id
	""" 
	];
	rr:subjectMap [
		rr:template 'http://www.ejustice.just.fgov.be/eli/{"typeDocumentURI"}/{"datumDocumentJaar"}/{"datumDocumentMaand"}/{"datumDocumentDag"}/{"ID"}'; #Fallback (Blank note) voorzien indien artikel van voor 97 is (toen nog geen Numac toegevoegd) -> pagina staatsblad, maakt met datum unieke verwijzing)
		rr:class eli:LegalResource; 
	];
	rr:predicateObjectMap [ 
		rr:predicate eli:is_about; 
		rr:objectMap [rr:column '"thema"'];
	].


map:VerschijningsvormDocument
	rr:logicalTable [rr:sqlQuery """
		SELECT	id AS VlacoID,
				ISNULL(Commentaar, '') AS beschrijving,
				CONVERT(date, BSDatum) AS publicatiedatum,
				Numac AS lokaleID,
				ISNULL(Opschrift, '') AS opschrift,
				(CASE 
					WHEN CONVERT(date, StartDatum) in (CONVERT(date, '01/01/2100'), CONVERT(date, '01/01/2100'), CONVERT(date, '01/01/2100')) THEN  null
					ELSE CONVERT(date, StartDatum) 
				END) AS inwerkingtreding,
				(CASE 
					WHEN CONVERT(date, EindDatum) in (CONVERT(date, '01/01/2100'), CONVERT(date, '01/01/2100'), CONVERT(date, '01/01/2100')) THEN  null
					ELSE CONVERT(date, EindDatum) 
				END) AS buitenwerkingtreding
		FROM WetgevingDocument
	"""];
	rr:subjectMap [
		rr:template 'https://codex.vlaanderen.be/doc/document/{"VlacoID"}';
		rr:class eli:LegalExpression; 
	];
	rr:predicateObjectMap [ 
		rr:predicate dcterms:description; 
		rr:objectMap [rr:column '"beschrijving"'];
	];
	rr:predicateObjectMap [ 
		rr:predicate eli:date_publication; 
		rr:objectMap [rr:column '"publicatiedatum"'];
	];
	rr:predicateObjectMap [ 
		rr:predicate eli:first_date_entry_in_force; 
		rr:objectMap [rr:column '"inwerkingtreding"'];
	];
	rr:predicateObjectMap [ 
		rr:predicate eli:date_no_longer_in_force; 
		rr:objectMap [rr:column '"buitenwerkingtreding"'];
	];
	rr:predicateObjectMap [ 
		rr:predicate eli:id_local; 
		rr:objectMap [
			rr:column '"lokaleID"';
			rr:termType rr:Literal; 
		];
	];
	rr:predicateObjectMap [ 
		rr:predicate eli:title; 
		rr:objectMap [rr:column '"opschrift"'];
	];
	rr:predicateObjectMap [
		rr:predicate codex:realiseert; 
		rr:objectMap [
			rr:parentTriplesMap map:RechtsgrondDocument; 
			rr:joinCondition [
				rr:child 'VlacoID';
				rr:parent 'id';
			]
		]
	].

map:VerschijningsvormArtikel
	rr:logicalTable [ rr:sqlQuery """
		SELECT	id AS VlacoID,
				Tekst AS inhoud
		FROM WetgevingArtikelVersie
	""" 
	];
	rr:subjectMap [
		rr:template 'https://codex.vlaanderen.be/doc/artikel/{"VlacoID"}';
		rr:class eli:LegalExpression; 
	];
	rr:predicateObjectMap [ 
		rr:predicate prov:value; 
		rr:objectMap [rr:column '"inhoud"'];
	].